<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="application-name" content="Riviera 53">
<meta name="apple-mobile-web-app-title" content="Riviera 53">
<link rel="manifest" href="manifest.json">

<link rel="icon" sizes="512x512" href="https://raw.githubusercontent.com/googleusercontent/image_generation_content/0/image_c35e16.png">
<link rel="apple-touch-icon" href="https://raw.githubusercontent.com/googleusercontent/image_generation_content/0/image_c35e16.png">
    <title>Riviera 53 Logbook</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #001f3f; padding: 10px; color: #333; margin: 0; }
        .card { background: white; padding: 20px; border-radius: 20px; max-width: 450px; margin: 10px auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: #004080; text-align: center; margin-bottom: 15px; font-size: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .section-header { color: #005a9c; font-weight: bold; margin-top: 15px; font-size: 14px; border-left: 5px solid #005a9c; padding: 6px 10px; background: #f0f7ff; border-radius: 0 5px 5px 0; }
        label { display: block; margin-top: 10px; font-weight: 600; font-size: 12px; color: #666; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; transition: 0.3s; }
        input:focus { border-color: #005a9c; outline: none; box-shadow: 0 0 5px rgba(0,90,156,0.2); }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 15px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-blue { background: #005a9c; color: white; }
        .btn-orange { background: #e67e22; color: white; margin-top: 15px; }
        .btn:active { transform: translateY(2px); box-shadow: none; }
        .total-box { background: #eef6ff; padding: 20px; border-radius: 15px; margin-top: 25px; border: 2px solid #004080; text-align: center; }
        .total-label { font-size: 13px; color: #004080; font-weight: bold; text-transform: uppercase; }
        .total-amount { font-size: 32px; font-weight: bold; color: #d9534f; display: block; margin-top: 5px; }
        .footer { font-size: 10px; color: #aaa; text-align: center; margin-top: 20px; padding-bottom: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Riviera 53 - Logbook</h2>
    
    <div class="section-header">Selecci√≥n de Traves√≠a</div>
    <label>Viajes en Archivo:</label>
    <select id="tripSelect" onchange="updateTotalDisplay()">
        <option value="">-- Conectando con Drive... --</option>
    </select>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <div>
            <label>Nuevo Destino:</label>
            <input type="text" id="newTripDest" placeholder="Ej: BVI">
        </div>
        <div>
            <label>Fecha Salida:</label>
            <input type="date" id="newTripDate">
        </div>
    </div>
    <button class="btn btn-blue" onclick="createNewTrip()">üöÄ CREAR NUEVA EXPEDICI√ìN</button>

    <div class="section-header">Registro de Gastos</div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <div>
            <label>Fecha Gasto:</label>
            <input type="date" id="fechaGasto">
        </div>
        <div>
            <label>Categor√≠a:</label>
            <select id="cat">
                <option value="Combustible">‚õΩ Diesel</option>
                <option value="Muelle">‚öì Muelle</option>
                <option value="Groceries">üõí Comida</option>
                <option value="F&B">üçΩÔ∏è F&B</option>
                <option value="Shopping">üõçÔ∏è Shop</option>
                <option value="Otros Gastos">‚öôÔ∏è Otros</option>
            </select>
        </div>
    </div>
    
    <label>Monto a Registrar ($):</label>
    <input type="number" id="monto" placeholder="0.00" step="0.01" inputmode="decimal">
    
    <button class="btn btn-orange" onclick="addExpense()">‚ûï REGISTRAR PARTIDA</button>

    <div class="total-box">
        <span class="total-label">Inversi√≥n Total del Viaje:</span>
        <span id="displayTotal" class="total-amount">$0.00</span>
    </div>

    <div class="footer">
        Casco: RIY53032D415 | Enterprise Manager v7.5<br>
        ¬© 2026 Edwin's Fleet Management
    </div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzPCH6rX8lhMjiFlr7J-3x1f3Ce3v9Uy3eVIzZ9kBEZGncH0QhVQjoIPYH0s-BruZ8S/exec';
    let listaViajes = [];

    async function cargarViajes(nombreASeleccionar = null) {
        try {
            const response = await fetch(scriptURL);
            listaViajes = await response.json();
            const select = document.getElementById('tripSelect');
            select.innerHTML = '<option value="">-- Selecciona un viaje --</option>';
            listaViajes.forEach(v => {
                select.innerHTML += `<option value="${v.nombre}">${v.nombre}</option>`;
            });
            if (nombreASeleccionar) {
                select.value = nombreASeleccionar;
                updateTotalDisplay();
            }
        } catch (e) { console.error("Error de sincronizaci√≥n"); }
    }

    function updateTotalDisplay() {
        const nombre = document.getElementById('tripSelect').value;
        const viaje = listaViajes.find(v => v.nombre === nombre);
        document.getElementById('displayTotal').innerText = viaje ? `$${viaje.total.toFixed(2)}` : "$0.00";
    }

    async function createNewTrip() {
        const dest = document.getElementById('newTripDest').value;
        const date = document.getElementById('newTripDate').value;
        if(!dest || !date) return alert("Faltan datos para la expedici√≥n");
        const uniqueTripName = `${dest} - ${date}`;
        await enviar({ type: "NUEVO_VIAJE", tripName: uniqueTripName, fecha: date });
        document.getElementById('newTripDest').value = "";
        await cargarViajes(uniqueTripName);
    }

    async function addExpense() {
        const name = document.getElementById('tripSelect').value;
        const monto = parseFloat(document.getElementById('monto').value);
        if(!name || isNaN(monto)) return alert("Elige viaje e ingresa el monto");

        await enviar({
            type: "GASTO_DETALLE",
            tripName: name,
            categoria: document.getElementById('cat').value,
            monto: monto,
            fecha: document.getElementById('fechaGasto').value
        });
        document.getElementById('monto').value = "";
        setTimeout(() => cargarViajes(name), 1500);
    }

    async function enviar(data) {
        try {
            await fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
            alert("‚úÖ Drive Actualizado");
        } catch (e) { alert("‚ùå Error de red"); }
    }

    const today = new Date().toISOString().split('T')[0];
    document.getElementById('newTripDate').value = today;
    document.getElementById('fechaGasto').value = today;
    cargarViajes();
</script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('./sw.js').then(function(registration) {
        console.log('ServiceWorker registrado');
      }, function(err) {
        console.log('Error en ServiceWorker', err);
      });
    });
  }
</script>
</body>
</html>







